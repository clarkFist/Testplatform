# 分批推送脚本使用说明

## 脚本简介

`batch_push.py` 是一个安全的分批提交和推送脚本，专门用于解决大型项目无法一次性提交所有文件的问题。脚本会智能地将待提交文件按大小分组，然后逐批提交和推送到远程仓库。

## 主要功能

- 🔍 **智能文件分组**: 按文件大小将待提交文件分成合适的批次
- 📦 **分批提交**: 每批文件单独提交，避免单次提交过大
- 🔄 **重试机制**: 推送失败时自动重试，提高成功率
- 📊 **进度显示**: 实时显示处理进度和文件信息
- ⚙️ **灵活配置**: 支持多种参数自定义

## 使用方法

### 基本用法

```bash
# 使用默认设置（50MB每批，推送到origin/main）
python scripts/batch_push.py
```

### 自定义参数

```bash
# 设置每批大小为30MB
python scripts/batch_push.py --batch-size 30

# 指定远程仓库和分支
python scripts/batch_push.py --remote origin --branch develop

# 自定义提交信息前缀
python scripts/batch_push.py --commit-prefix "项目更新"

# 设置重试次数和间隔
python scripts/batch_push.py --retries 5 --delay 10
```

### 完整参数示例

```bash
python scripts/batch_push.py \
  --batch-size 25 \
  --remote upstream \
  --branch feature/new-updates \
  --commit-prefix "功能更新" \
  --retries 5 \
  --delay 8
```

## 参数说明

| 参数 | 默认值 | 说明 |
|------|--------|------|
| `--batch-size` | 50 | 每批最大大小(MB) |
| `--remote` | origin | 远程仓库名 |
| `--branch` | main | 目标分支名 |
| `--commit-prefix` | 分批提交 | 提交信息前缀 |
| `--retries` | 3 | 推送失败重试次数 |
| `--delay` | 5 | 重试间隔时间(秒) |

## 工作流程

1. **检查环境**: 验证当前目录是否为git仓库
2. **获取文件**: 扫描所有待提交的文件
3. **智能分组**: 按大小将文件分成合适的批次
4. **显示预览**: 展示分批情况供用户确认
5. **逐批处理**: 
   - 添加文件到暂存区
   - 创建提交
   - 推送到远程仓库
   - 失败时自动重试

## 安全特性

- ✅ **确认机制**: 执行前显示分批预览，需要用户确认
- ✅ **错误处理**: 完善的错误处理和反馈机制
- ✅ **重试逻辑**: 网络不稳定时自动重试推送
- ✅ **失败停止**: 某批失败时停止后续操作，避免混乱

## 适用场景

- 大型项目初次推送到GitHub
- 包含大量媒体文件的项目
- 网络环境不稳定的情况
- 需要避免单次提交过大的场景

## 注意事项

1. **备份重要数据**: 虽然脚本很安全，但建议在重要项目上使用前先备份
2. **网络稳定性**: 确保网络连接相对稳定，避免频繁断网
3. **文件路径**: 文件路径中包含特殊字符可能需要额外处理
4. **权限检查**: 确保有对目标仓库的推送权限

## 示例输出

```
开始分批提交流程...
正在获取待提交文件列表...
找到 156 个待提交文件
按 50MB 大小分批...
共分为 3 批:
  第 1 批: 45 个文件, 约 48.2MB
  第 2 批: 67 个文件, 约 49.8MB
  第 3 批: 44 个文件, 约 25.6MB

是否继续分批提交? (y/N): y

=== 处理第 1/3 批文件 ===
包含 45 个文件:
  - src/main.py
  - assets/image1.jpg
  ...
  尝试推送... (第 1 次)
  ✓ 第 1 批推送成功
等待 5 秒后处理下一批...

=== 完成 ===
成功处理: 3/3 批
```

## 故障排除

如果遇到问题，请检查：

1. **Git状态**: `git status` 确认仓库状态正常
2. **远程连接**: `git remote -v` 检查远程仓库配置
3. **网络连接**: 确保能正常访问GitHub
4. **权限问题**: 检查SSH密钥或访问令牌是否正确设置 